<!DOCTYPE html>
<html lang="it" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cleto Chiarli | Modena 1860</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'chiarli-stone': '#EBE9E4',  // The warm grey/beige background
              'chiarli-wine': '#4A0D15',   // Deep elegant red
              'chiarli-wine-light': '#D64550',   // Brighter red for dark backgrounds
              'chiarli-text': '#1C1917',   // Soft charcoal black
              'chiarli-gold': '#D4AF37',
              'chiarli-muted': '#6B6560',  // Warm grey for secondary text
            },
            fontFamily: {
              serif: ['"Playfair Display"', 'serif'],
              sans: ['"Lato"', 'sans-serif'],
            },
            backgroundImage: {
              'grain': "url('data:image/svg+xml,%3Csvg viewBox=\"0 0 200 200\" xmlns=\"http://www.w3.org/2000/svg\"%3E%3Cfilter id=\"noiseFilter\"%3E%3CfeTurbulence type=\"fractalNoise\" baseFrequency=\"0.65\" numOctaves=\"3\" stitchTiles=\"stitch\"/%3E%3C/filter%3E%3Crect width=\"100%25\" height=\"100%25\" filter=\"url(%23noiseFilter)\" opacity=\"0.05\"/%3E%3C/svg%3E')",
            }
          },
        },
      }
    </script>
    <!-- Importing Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:ital,wght@0,400;0,600;1,400;1,600&display=swap" rel="stylesheet">
    <style>
      body {
        background-color: #EBE9E4;
        color: #1C1917;
      }
      .vertical-text {
        writing-mode: vertical-rl;
        text-orientation: mixed;
        transform: rotate(180deg);
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.554.0"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
  <body class="antialiased selection:bg-chiarli-wine selection:text-white">
    <div id="root"></div>
  <script type="module" src="/src/index.tsx"></script>

  <!-- CMS Text Selection Detection -->
  <script>
    (function() {
      // Only run if we're in an iframe (inside CMS dashboard)
      if (window.self === window.top) return;

      let selectionTimeout;

      // Helper: trova il contesto dell'elemento selezionato
      function getSelectionContext(element) {
        if (!element) return {};

        // Cerca data attributes utili risalendo il DOM
        let current = element;
        let context = {
          tagName: element.tagName?.toLowerCase(),
          className: element.className || '',
          id: element.id || '',
          section: null,
          component: null,
          contentType: null,
          itemId: null
        };

        while (current && current !== document.body) {
          // Cerca data-section, data-component, data-content-type, data-item-id
          if (current.dataset) {
            if (current.dataset.section && !context.section) {
              context.section = current.dataset.section;
            }
            if (current.dataset.component && !context.component) {
              context.component = current.dataset.component;
            }
            if (current.dataset.contentType && !context.contentType) {
              context.contentType = current.dataset.contentType;
            }
            if (current.dataset.itemId && !context.itemId) {
              context.itemId = current.dataset.itemId;
            }
          }

          // Cerca section o main con id
          if ((current.tagName === 'SECTION' || current.tagName === 'MAIN') && current.id && !context.section) {
            context.section = current.id;
          }

          current = current.parentElement;
        }

        return context;
      }

      document.addEventListener('mouseup', function(e) {
        clearTimeout(selectionTimeout);

        selectionTimeout = setTimeout(function() {
          const selection = window.getSelection();
          const selectedText = selection.toString().trim();

          if (selectedText && selectedText.length > 2 && selectedText.length < 500) {
            // Ottieni l'elemento che contiene la selezione
            const anchorNode = selection.anchorNode;
            const element = anchorNode?.nodeType === Node.TEXT_NODE
              ? anchorNode.parentElement
              : anchorNode;

            // Raccogli contesto
            const context = getSelectionContext(element);

            // Ottieni la pagina corrente dal hash (React Router)
            const currentPath = window.location.hash.replace('#', '') || '/';

            // Send selected text to parent (CMS dashboard) con contesto
            window.parent.postMessage({
              type: 'CMS_TEXT_SELECTED',
              text: selectedText,
              page: currentPath,
              context: context
            }, '*');
          }
        }, 300);
      });
    })();
  </script>
</body>
</html>